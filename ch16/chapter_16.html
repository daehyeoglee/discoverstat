<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daehyeog Lee">
<meta name="dcterms.date" content="2023-02-19">

<title>Chapter 16. Multivariate analysis of variance (MANOVA)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="chapter_16_files/libs/clipboard/clipboard.min.js"></script>
<script src="chapter_16_files/libs/quarto-html/quarto.js"></script>
<script src="chapter_16_files/libs/quarto-html/popper.min.js"></script>
<script src="chapter_16_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="chapter_16_files/libs/quarto-html/anchor.min.js"></script>
<link href="chapter_16_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="chapter_16_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="chapter_16_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="chapter_16_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="chapter_16_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 16. Multivariate analysis of variance (MANOVA)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daehyeog Lee </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 19, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 26, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="what-will-this-chapter-tell-me" class="level2">
<h2 class="anchored" data-anchor-id="what-will-this-chapter-tell-me">16.1. What will this chapter tell me?</h2>
<p>When we want to compare groups on several outcome variables we can extend ANOVA to become MANOVA.</p>
</section>
<section id="when-to-use-manova" class="level2">
<h2 class="anchored" data-anchor-id="when-to-use-manova">16.2. When to use MANOVA</h2>
<p>ANOVA can be used only in situations in which there is one dependent variable and so is known as a <strong>univariate</strong> test.</p>
<p>MANOVA is designed to look at several dependent variables simultaneously and so is a <strong>multivariate</strong> test.</p>
</section>
<section id="introduction-similarities-to-and-differences-from-anova" class="level2">
<h2 class="anchored" data-anchor-id="introduction-similarities-to-and-differences-from-anova">16.3. Introduction: similarities to and differences from ANOVA</h2>
<p>Why not do lots of ANOVAs?</p>
<p>This is same as using ANOVA in preference to multiple <em>t</em>-tests. The more tests we conduct on the same data, the more we inflate the familywise error rate.</p>
<p>Also, if separate ANOVAs are conducted on each dependent variable, then <strong>any relationship between dependent variables is ignored.</strong> MANOVA includes all dependent variables in the same analysis, taking account of the relationship between outcome variables.</p>
<p>ANOVA can tell us only whether groups differ along a single dimension, whereas MANOVA has the power to detect whether groups differ along a combination of dimensions.</p>
<section id="words-of-warning." class="level3">
<h3 class="anchored" data-anchor-id="words-of-warning.">16.3.1. Words of warning.</h3>
<p>We should not include lots of dependent variables in a MANOVA just because we have measured them. In circumstances where there is a good theoretical basis for including some but not all of our dependent variables, we should run separate analysis.</p>
</section>
<section id="the-example-for-this-chapter" class="level3">
<h3 class="anchored" data-anchor-id="the-example-for-this-chapter">16.3.2. The example for this chapter</h3>
<p>Predictor: Treatment (CBT / BT / NT); 3 Groups</p>
<p>Outcome: Actions, Thoughts</p>
</section>
</section>
<section id="theory-of-manova" class="level2">
<h2 class="anchored" data-anchor-id="theory-of-manova">16.4. Theory of MANOVA</h2>
<p>The theory of MANOVA is very complex to understand without knowing matrix algebra.</p>
<section id="introduction-to-matrices" class="level3">
<h3 class="anchored" data-anchor-id="introduction-to-matrices">16.4.1. Introduction to matrices</h3>
<p>Row, column, square matrix, identity matrix</p>
<p>Row vector represents single person’s score on four different variables.<br>
Column vector represents all participants’ scores on one variable.</p>
</section>
<section id="some-important-matrices-and-their-functions" class="level3">
<h3 class="anchored" data-anchor-id="some-important-matrices-and-their-functions">16.4.2. Some important matrices and their functions</h3>
<p>The test statistic in both ANOVA and MANOVA represents the ratio of the effect of the systematic variance to the unsystematic variance</p>
<ul>
<li><p>ANOVA: These variances are single values, calculated from <span class="math inline">\(SS_M, SS_R\)</span> and <span class="math inline">\(SS_T\)</span>.</p></li>
<li><p>MANOVA: Comparison is made by using the ratio of a <strong>matrix</strong> representing the systematic variance of all dependent variables to a matrix representing the unsystematic variance of all dependent variables.</p></li>
</ul>
</section>
<section id="calculating-manova-by-hand-a-worked-example" class="level3">
<h3 class="anchored" data-anchor-id="calculating-manova-by-hand-a-worked-example">16.4.3. Calculating MANOVA by hand: a worked example</h3>
<section id="univariate-anova-for-dv-1-actions" class="level4">
<h4 class="anchored" data-anchor-id="univariate-anova-for-dv-1-actions">16.4.3.1. Univariate ANOVA for DV 1 (Actions)</h4>
</section>
<section id="univariate-anova-for-dv-2-thoughts" class="level4">
<h4 class="anchored" data-anchor-id="univariate-anova-for-dv-2-thoughts">16.4.3.2. Univariate ANOVA for DV 2 (Thoughts)</h4>
</section>
<section id="the-relationship-between-dvs-cross-products" class="level4">
<h4 class="anchored" data-anchor-id="the-relationship-between-dvs-cross-products">16.4.3.3. The relationship between DVs: cross-products</h4>
</section>
<section id="the-total-sscp-matrix-t" class="level4">
<h4 class="anchored" data-anchor-id="the-total-sscp-matrix-t">16.4.3.4. The total SSCP matrix (T)</h4>
<p>Since we have only two dependent variables, all the SSCP matrices will be 2 x 2 matrices.</p>
<p>The total SSCP matrix, <em>T</em>, contains the total sums of squares for each dependent variable and the total cross-product between the two dependent variables.</p>
</section>
<section id="the-residual-sscp-matrix-e" class="level4">
<h4 class="anchored" data-anchor-id="the-residual-sscp-matrix-e">16.4.3.5. The residual SSCP matrix (E)</h4>
</section>
<section id="the-model-sscp-matrix-h" class="level4">
<h4 class="anchored" data-anchor-id="the-model-sscp-matrix-h">16.4.3.6. The model SSCP matrix (H)</h4>
</section>
</section>
<section id="principle-of-the-manova-test-statistic" class="level3">
<h3 class="anchored" data-anchor-id="principle-of-the-manova-test-statistic">16.4.4. Principle of the MANOVA test statistic</h3>
<section id="discriminant-function-variates" class="level4">
<h4 class="anchored" data-anchor-id="discriminant-function-variates">16.4.4.1. Discriminant function variates</h4>
<p>The linear combinations of the dependent variables are known as <em>variates</em>. In this context we wish to use these linear variates to predict which group a person belongs to. Therefore, these variates are called <em>discriminant functions</em> or <strong>discriminant function variates</strong>.</p>
<p>The <em>b</em>-values that describe the variates are obtained by calculating the eigenvectors of the matrix <span class="math inline">\(HE^{-1}\)</span>.</p>
</section>
<section id="pillai-bartlett-trace-v" class="level4">
<h4 class="anchored" data-anchor-id="pillai-bartlett-trace-v">16.4.4.2. Pillai-Bartlett trace (V)</h4>
<p>Pillai’s trace is the sum of the proportion of explained variance on the discriminant functions. It is similar to the ratio of <span class="math inline">\(\frac{SS_M}{SS_T}\)</span>, which is known as <span class="math inline">\(R^2\)</span>.</p>
</section>
<section id="hotellings-t2" class="level4">
<h4 class="anchored" data-anchor-id="hotellings-t2">16.4.4.3. Hotelling’s <span class="math inline">\(T^2\)</span></h4>
<p>The Hotelling-Lawley trace is simply the sum of the eigenvalues for each variate. This test statistic is the sum of <span class="math inline">\(\frac{SS_M}{SS_R}\)</span> for each of the variates and so it compares directly to the <em>F</em>-ratio in ANOVA.</p>
</section>
<section id="wilkss-lambda" class="level4">
<h4 class="anchored" data-anchor-id="wilkss-lambda">16.4.4.4. Wilks’s lambda</h4>
<p>Wilks’s lambda is the product of the unexplained variance on each of the variates. Therefore, the large eigenvalues lead to small values of Wilks’s lambda.</p>
</section>
<section id="roys-largest-root" class="level4">
<h4 class="anchored" data-anchor-id="roys-largest-root">16.4.4.5. Roy’s largest root</h4>
<p>This is the eigenvalue for the first variate. It represents the proportion of explained variance to unexplained variance for the first discriminant function.</p>
</section>
</section>
</section>
<section id="practical-issues-when-conducting-manova" class="level2">
<h2 class="anchored" data-anchor-id="practical-issues-when-conducting-manova">16.5. Practical issues when conducting MANOVA</h2>
<section id="assumptions-and-how-to-check-them" class="level3">
<h3 class="anchored" data-anchor-id="assumptions-and-how-to-check-them">16.5.1. Assumptions and how to check them</h3>
<p>MANOVA has similar assumptions to ANOVA but extended to the multivariate case:</p>
<ul>
<li><p>Independence, Random sampling</p></li>
<li><p>Multivariate Normality</p>
<ul>
<li><p>ANOVA: Our dependent variable should be normally distributed within each group.</p></li>
<li><p>MANOVA: The dependent variables should have multivariate normality within groups.</p></li>
</ul></li>
<li><p>Homogeneity of covariance matrices</p>
<ul>
<li><p>ANOVA: The variances in each group should be roughly equal.</p></li>
<li><p>MANOVA: + The correlation between any two dependent variables should be the same in all groups. This is examined by testing whether the population <strong>variance-covariance matrices</strong> of the different groups in the analysis are equal.</p></li>
</ul></li>
</ul>
</section>
<section id="choosing-a-test-statistic" class="level3">
<h3 class="anchored" data-anchor-id="choosing-a-test-statistic">16.5.2. Choosing a test statistic</h3>
<p>With unequal group sizes, check the homogeneity of covariance matrices. If they seem homogeneous and if the assumption of multivariate normality is tenable, then assume that Pillai’s trace is accurate.</p>
</section>
<section id="follow-up-analysis" class="level3">
<h3 class="anchored" data-anchor-id="follow-up-analysis">16.5.3. Follow-up analysis</h3>
<p>The traditional approach is to follow a significant MANOVA with separate ANOVAs on each of the dependent variables. We might want to consider applying a Bonferroni correction to the subsequent ANOVAs.</p>
</section>
</section>
<section id="manova-using-r" class="level2">
<h2 class="anchored" data-anchor-id="manova-using-r">16.6. MANOVA using R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car); <span class="fu">library</span>(compute.es); <span class="fu">library</span>(effects); <span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>lattice theme set by effectsTheme()
See ?effectsTheme for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(multcomp); <span class="fu">library</span>(pastecs); <span class="fu">library</span>(WRS2); <span class="fu">library</span>(reshape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: mvtnorm</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: survival</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: TH.data</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'TH.data'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MASS':

    geyser</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here); <span class="fu">library</span>(ez); <span class="fu">library</span>(nlme); <span class="fu">library</span>(clinfun); <span class="fu">library</span>(pgirmess)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/leedh/self_study/discoverstat</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS); <span class="fu">library</span>(mvoutlier); <span class="fu">library</span>(mvnormtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sgeostat</code></pre>
</div>
</div>
<section id="general-procedure-for-manova" class="level3">
<h3 class="anchored" data-anchor-id="general-procedure-for-manova">16.6.2. General procedure for MANOVA</h3>
<ul>
<li><p>Enter data</p></li>
<li><p>Explore data (graphs, descriptive statistics)</p></li>
<li><p>Set contrasts</p></li>
<li><p>Compute MANOVA</p></li>
<li><p>Run univariate ANOVA</p></li>
<li><p>Discriminant function analysis</p></li>
</ul>
</section>
<section id="manova-using-r-commander" class="level3">
<h3 class="anchored" data-anchor-id="manova-using-r-commander">16.6.3. MANOVA using R Commander</h3>
<p>We cannot directly do a MANOVA using R Commander.</p>
</section>
<section id="entering-the-data" class="level3">
<h3 class="anchored" data-anchor-id="entering-the-data">16.6.4. Entering the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ocdData <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="fu">here</span>(<span class="st">"ch16"</span>, <span class="st">"OCD.dat"</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ocdData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Group Actions Thoughts
1   CBT       5       14
2   CBT       5       11
3   CBT       4       16
4   CBT       4       13
5   CBT       5       12
6   CBT       3       14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the level</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ocdData<span class="sc">$</span>Group <span class="ot">&lt;-</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    ocdData<span class="sc">$</span>Group,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"CBT"</span>, <span class="st">"BT"</span>, <span class="st">"No Treatment Control"</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"CBT"</span>, <span class="st">"BT"</span>, <span class="st">"NT"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exploring-the-data" class="level3">
<h3 class="anchored" data-anchor-id="exploring-the-data">16.6.5. Exploring the data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ocdScatter <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ocdData, <span class="fu">aes</span>(Actions, Thoughts))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ocdScatter <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Obsession-Related Behaviours"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Obsession-Related Thoughts"</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Group, <span class="at">ncol =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_16_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ocdMelt <span class="ot">&lt;-</span> <span class="fu">melt</span>(ocdData, <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"Group"</span>), <span class="at">measured =</span> <span class="fu">c</span>(<span class="st">"Actions"</span>, <span class="st">"Thoughts"</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ocdMelt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Group"</span>, <span class="st">"Outcome_Measure"</span>, <span class="st">"Frequency"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>ocdBar <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ocdMelt, <span class="fu">aes</span>(Group, Frequency, <span class="at">fill =</span> Outcome_Measure))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>ocdBar <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.y =</span> mean, <span class="at">geom =</span> <span class="st">"bar"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun.data =</span> mean_cl_boot,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"errorbar"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.90</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Thoughts/Actions"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Outcome Measure"</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `fun.y` argument of `stat_summary()` is deprecated as of ggplot2 3.3.0.
ℹ Please use the `fun` argument instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_16_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ocdBoxplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ocdMelt, <span class="fu">aes</span>(Group, Frequency, <span class="at">colour =</span> Outcome_Measure))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ocdBoxplot <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Treatment Group"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Thoughts/Actions"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Outcome Measure"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter_16_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For actions, BT appears to reduce the number of obsessive behaviors compared to CBT and NT. For thoughts, CBT reduces the number of obsessive thoughts compared to BT and NT.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(ocdData<span class="sc">$</span>Actions, ocdData<span class="sc">$</span>Group, stat.desc, <span class="at">basic =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ocdData$Group: CBT
      median         mean      SE.mean CI.mean.0.95          var      std.dev 
   5.0000000    4.9000000    0.3785939    0.8564389    1.4333333    1.1972190 
    coef.var 
   0.2443304 
------------------------------------------------------------ 
ocdData$Group: BT
      median         mean      SE.mean CI.mean.0.95          var      std.dev 
   4.0000000    3.7000000    0.5587685    1.2640221    3.1222222    1.7669811 
    coef.var 
   0.4775625 
------------------------------------------------------------ 
ocdData$Group: NT
      median         mean      SE.mean CI.mean.0.95          var      std.dev 
   5.0000000    5.0000000    0.3333333    0.7540524    1.1111111    1.0540926 
    coef.var 
   0.2108185 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(ocdData<span class="sc">$</span>Thoughts, ocdData<span class="sc">$</span>Group, stat.desc, <span class="at">basic =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ocdData$Group: CBT
      median         mean      SE.mean CI.mean.0.95          var      std.dev 
  13.5000000   13.4000000    0.6000000    1.3572943    3.6000000    1.8973666 
    coef.var 
   0.1415945 
------------------------------------------------------------ 
ocdData$Group: BT
      median         mean      SE.mean CI.mean.0.95          var      std.dev 
  14.5000000   15.2000000    0.6633250    1.5005453    4.4000000    2.0976177 
    coef.var 
   0.1380012 
------------------------------------------------------------ 
ocdData$Group: NT
      median         mean      SE.mean CI.mean.0.95          var      std.dev 
  14.0000000   15.0000000    0.7453560    1.6861124    5.5555556    2.3570226 
    coef.var 
   0.1571348 </code></pre>
</div>
</div>
<p>To check the homogeneity of covariance matrices we don’t do a formal test, but simply compare the values within them. To get the variance-covariance matrices for each group we can again use the <code>by()</code> function but in combination with the <code>cov()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(ocdData[, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>], ocdData<span class="sc">$</span>Group, cov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ocdData$Group: CBT
            Actions   Thoughts
Actions  1.43333333 0.04444444
Thoughts 0.04444444 3.60000000
------------------------------------------------------------ 
ocdData$Group: BT
          Actions Thoughts
Actions  3.122222 2.511111
Thoughts 2.511111 4.400000
------------------------------------------------------------ 
ocdData$Group: NT
           Actions  Thoughts
Actions   1.111111 -1.111111
Thoughts -1.111111  5.555556</code></pre>
</div>
</div>
<p>The outcome shows the variance-covariance matrices for each group. The diagonal elements represent the variances for each outcome measure and the off-diagonals are the covariances.<br>
The variances for actions are a little different across groups (1.43, 3.12, 1.11). The variances for thoughts are really quite similar (3.60, 4.40, 5.56). The variance ratio (the largest variance relative to smallest) is about 1.5, which is below the threshold of 2.<br>
Looking at the covariances, these are also different (0.04, 2.51, -1.11). This difference reflects the different relationships between thoughts and actions across the groups.<br>
There is evidence to suggest that the matrices are different across groups. However, given the group sizes are equal we probably don’t need to worry too much about these differences.</p>
<p>The final assumption that we need to test is multivariate normality. We can do this using the <code>mshapiro.test()</code> function. We need to apply this test to the groups individually, so the first thing to do is to extract the data for each group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># [row to extract, column to extract]</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>cbt <span class="ot">&lt;-</span> ocdData[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Transpose the data</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>cbt <span class="ot">&lt;-</span> <span class="fu">t</span>(cbt)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>bt <span class="ot">&lt;-</span> <span class="fu">t</span>(ocdData[<span class="dv">11</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>nt <span class="ot">&lt;-</span> <span class="fu">t</span>(ocdData[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mshapiro.test</span>(cbt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  Z
W = 0.9592, p-value = 0.7767</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mshapiro.test</span>(bt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  Z
W = 0.89122, p-value = 0.175</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mshapiro.test</span>(nt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  Z
W = 0.82605, p-value = 0.02998</code></pre>
</div>
</div>
</section>
<section id="setting-contrasts" class="level3">
<h3 class="anchored" data-anchor-id="setting-contrasts">16.6.6. Setting contrasts</h3>
</section>
<section id="the-manova-model" class="level3">
<h3 class="anchored" data-anchor-id="the-manova-model">16.6.7. The MANOVA model</h3>
</section>
<section id="follow-up-analysis-univariate-test-statistics" class="level3">
<h3 class="anchored" data-anchor-id="follow-up-analysis-univariate-test-statistics">16.6.8. Follow-up analysis: univariate test statistics</h3>
</section>
<section id="contrasts" class="level3">
<h3 class="anchored" data-anchor-id="contrasts">16.6.9. Contrasts</h3>
</section>
</section>
<section id="robust-manova" class="level2">
<h2 class="anchored" data-anchor-id="robust-manova">16.7. Robust MANOVA</h2>
</section>
<section id="reporting-results-from-manova" class="level2">
<h2 class="anchored" data-anchor-id="reporting-results-from-manova">16.8. Reporting results from MANOVA</h2>
</section>
<section id="following-up-manova-with-discriminant-analysis" class="level2">
<h2 class="anchored" data-anchor-id="following-up-manova-with-discriminant-analysis">16.9. Following up MANOVA with discriminant analysis</h2>
</section>
<section id="reporting-results-from-discriminant-analysis" class="level2">
<h2 class="anchored" data-anchor-id="reporting-results-from-discriminant-analysis">16.10. Reporting results from discriminant analysis</h2>
</section>
<section id="some-final-remarks" class="level2">
<h2 class="anchored" data-anchor-id="some-final-remarks">16.11. Some final remarks</h2>
<section id="the-final-interpretation" class="level3">
<h3 class="anchored" data-anchor-id="the-final-interpretation">16.11.1. The final interpretation</h3>
</section>
<section id="univariate-anova-or-discriminant-analysis" class="level3">
<h3 class="anchored" data-anchor-id="univariate-anova-or-discriminant-analysis">16.11.2. Univariate ANOVA or discriminant analysis?</h3>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>